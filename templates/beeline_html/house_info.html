{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}
{% block title %}Информация о доме{% endblock %}
{% block content %}
<div class="container-fluid">
<h1>{{ name }}</h1>
<p></p>
    <div class="row">
        <div class="col-md-4">
            <div class="accordion" id="accordionExample">
                {% for gp in gp_houses %}
                    <div class="card">
                        <div class="card-header" id="headingOne">
                            <h2 class="mb-0">
                                <button class="btn btn-link" type="button" data-toggle="collapse"
                                        data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    Глобальная проблема #{{ forloop.counter }}
                                </button>
                            </h2>
                        </div>

                        <div id="collapseOne" class="collapse" aria-labelledby="headingOne"
                             data-parent="#accordionExample">
                            <div class="card-body">
                                {{ gp }}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    <div class="col-md-4">
            {{ form|crispy }}
    </div>
        <div class="col-md-4">
            <div style="position: relative">
                <div id="datetimepicker12"></div>
                <img id='load' src="{% static 'image/load.gif' %}"
                     style="visibility: hidden; top: 20px; left: 30px; z-index: 5; position: absolute">
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_scripts %}
    <script type="text/javascript">
    $.datetimepicker.setLocale('ru');
    $('#id_datetime').datetimepicker({
        format: 'd.m.Y H:i',
    });
    $(function () {
        $('#datetimepicker12').datetimepicker(
            {
                format: 'd.m.Y H:i',
                inline: true,
                sideBySide: true,
                allowTimes: ['00:00'],
                todayButton: true,
                timepickerScrollbar: false,
                onSelectDate: function (value) {
                    let globalDate = [];
                    $.ajax({
                        url: `./schedule/${value.getFullYear()}/${value.getMonth() + 1}/${value.getDate()}`,
                        dataType: "json",
                        success: function (result) {
                            $.each(result, function (key, value) {
                                globalDate.push(key);
                            });
                            if (globalDate.length < 1) {
                                globalDate = ['00:00']
                            }
                            $('#datetimepicker12').datetimepicker('setOptions', {allowTimes: globalDate});
                            {#.html(">')#}
                            console.log(globalDate);
                            document.getElementById('load').style.visibility = 'hidden'
                        },
                        beforeSend: function () {
                            document.getElementById('load').style.visibility = 'visible'
                        },
                        error: function () {
                            alert('Произошка ошибка, попробуйте снова');
                            document.getElementById('load').style.visibility = 'hidden'
                        }
                    });
                }
            });
    });
</script>
{% endblock %}